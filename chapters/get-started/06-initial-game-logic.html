

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Write an Initial Game Version &mdash; Erbsland Configuration Language Parser for C++ 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/erbsland-ansi/ansi.css?v=76679ccf" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=cba98b8c" />
      <link rel="stylesheet" type="text/css" href="../../_static/ansi.css" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="https://erbsland.dev/ext/fa7/js/all.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Compile and Run Our Game" href="07-compile-and-run.html" />
    <link rel="prev" title="Provoking Some Errors" href="05-provoking-errors.html" /> 
</head>

<body class="wy-body-for-nav">

 

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Erbsland Configuration Language Parser for C++
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01-project-structure.html">The Project Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-cmake-configuration.html">The CMake Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="03-write-minimal-main.html">Write a Minimal Main Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="04-compile-and-run.html">Compile and Run the Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-provoking-errors.html">Provoking Some Errors</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Write an Initial Game Version</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#geometry-classes">Geometry Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-canvas">The Canvas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-world">The World</a></li>
<li class="toctree-l3"><a class="reference internal" href="#game-logic">Game Logic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-game-classes">Using the Game Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#replacing-the-old-main-function">Replacing the Old Main Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-the-new-files-to-cmake">Adding the New Files to CMake</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recap">Recap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="07-compile-and-run.html">Compile and Run Our Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="08-improve-field.html">Make the Field Configurable</a></li>
<li class="toctree-l2"><a class="reference internal" href="09-using-value-lists.html">Using Value Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="10-the-next-steps.html">The Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage/index.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contributing Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../goals.html">Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Erbsland Configuration Language Parser for C++</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Getting Started</a></li>
      <li class="breadcrumb-item active">Write an Initial Game Version</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/chapters/get-started/06-initial-game-logic.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="write-an-initial-game-version">
<h1>Write an Initial Game Version<a class="headerlink" href="#write-an-initial-game-version" title="Link to this heading"></a></h1>
<p>Now that we have a working foundation, let’s implement the first version of our game!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You don’t need to type everything by hand. After each code listing, there’s a link to download the full source file.</p>
</div>
<section id="geometry-classes">
<h2>Geometry Classes<a class="headerlink" href="#geometry-classes" title="Link to this heading"></a></h2>
<p>We’ll start with some basic data structures that serve as building blocks for the game.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">robot-escape/src/Geometry.hpp</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#pragma once</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;array&gt;</span>
<span class="linenos"> 5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;random&gt;</span>
<span class="linenos"> 6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="kr">inline</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">randomInt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">minimum</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maximum</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="k">thread_local</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">mt19937</span><span class="w"> </span><span class="nf">rng</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">random_device</span><span class="p">{}());</span>
<span class="linenos">10</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">uniform_int_distribution</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="n">minimum</span><span class="p">,</span><span class="w"> </span><span class="n">maximum</span><span class="p">}(</span><span class="n">rng</span><span class="p">);</span>
<span class="linenos">11</span><span class="p">}</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="k">struct</span><span class="w"> </span><span class="nc">Position</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">14</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">{};</span>
<span class="linenos">15</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">{};</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="w">    </span><span class="n">Position</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="linenos">18</span><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="n">Position</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">{</span><span class="n">x</span><span class="p">},</span><span class="w"> </span><span class="n">y</span><span class="p">{</span><span class="n">y</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos">19</span><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="linenos">20</span><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="linenos">21</span><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">};</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">22</span><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">};</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">23</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">distanceTo</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">24</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="linenos">25</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">26</span><span class="p">};</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="k">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">Position</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cPosDelta4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">29</span><span class="w">    </span><span class="p">{{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">}}};</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="k">struct</span><span class="w"> </span><span class="nc">Size</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">32</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">{};</span>
<span class="linenos">33</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">{};</span>
<span class="linenos">34</span>
<span class="linenos">35</span><span class="w">    </span><span class="n">Size</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="linenos">36</span><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="n">Size</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">width</span><span class="p">{</span><span class="n">width</span><span class="p">},</span><span class="w"> </span><span class="n">height</span><span class="p">{</span><span class="n">height</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos">37</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">fitsInto</span><span class="p">(</span><span class="n">Size</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">38</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>
<span class="linenos">39</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">40</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">area</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">41</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">center</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">42</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">width</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span>
<span class="linenos">43</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">44</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Position</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">45</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
<span class="linenos">46</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">47</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">index</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Position</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">48</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="linenos">49</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">50</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">randomPosition</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">51</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)};</span>
<span class="linenos">52</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">53</span><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Fn</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">forEach</span><span class="p">(</span><span class="n">Fn</span><span class="w"> </span><span class="n">fn</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">54</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">55</span><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">56</span><span class="w">                </span><span class="n">fn</span><span class="p">(</span><span class="n">Position</span><span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">});</span>
<span class="linenos">57</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">58</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">59</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">60</span><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Fn</span><span class="o">&gt;</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">filterPositions</span><span class="p">(</span><span class="n">Fn</span><span class="w"> </span><span class="n">fn</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Position</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">61</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Position</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="linenos">62</span><span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">area</span><span class="p">());</span>
<span class="linenos">63</span><span class="w">        </span><span class="n">forEach</span><span class="p">([</span><span class="o">&amp;</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fn</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">Position</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">64</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">65</span><span class="w">        </span><span class="p">});</span>
<span class="linenos">66</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="linenos">67</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">68</span><span class="p">};</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../_downloads/d70d3f0cdc11ddda023fc25139615fb9/Geometry.hpp"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Geometry.hpp</span></code></a></p>
<p>In this file, we define the classes <code class="docutils literal notranslate"><span class="pre">Position</span></code> and <code class="docutils literal notranslate"><span class="pre">Size</span></code> with a minimal set of utility methods. These will be used throughout the game code.</p>
<p>Additionally, we define the function <code class="docutils literal notranslate"><span class="pre">randomInt()</span></code> and the directional offset array <code class="docutils literal notranslate"><span class="pre">cPosDelta4</span></code>, which will help with movement logic.</p>
</section>
<section id="the-canvas">
<h2>The Canvas<a class="headerlink" href="#the-canvas" title="Link to this heading"></a></h2>
<p>Instead of building a complex graphical interface, we use a simple <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> class that renders the game world as colored text in the console.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">robot-escape/src/Canvas.hpp</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#pragma once</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Geometry.hpp&quot;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<span class="linenos"> 6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="linenos"> 7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;numeric&gt;</span>
<span class="linenos"> 8</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ranges&gt;</span>
<span class="linenos"> 9</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<span class="linenos">10</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdint&gt;</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Block</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">13</span><span class="w">    </span><span class="n">Empty</span><span class="p">,</span>
<span class="linenos">14</span><span class="w">    </span><span class="n">Wall</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">    </span><span class="n">Room</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="n">Exit</span><span class="p">,</span>
<span class="linenos">17</span><span class="w">    </span><span class="n">Player</span><span class="p">,</span>
<span class="linenos">18</span><span class="w">    </span><span class="n">PlayerTrail</span><span class="p">,</span>
<span class="linenos">19</span><span class="w">    </span><span class="n">Robot</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">    </span><span class="n">RobotTrail</span><span class="p">,</span>
<span class="linenos">21</span><span class="p">};</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="k">struct</span><span class="w"> </span><span class="nc">Canvas</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">24</span><span class="w">    </span><span class="n">Size</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="linenos">25</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Block</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="linenos">26</span><span class="w">    </span><span class="n">Position</span><span class="w"> </span><span class="n">topLeft</span><span class="p">;</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">cDefaultSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Size</span><span class="p">{</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">};</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">Canvas</span><span class="p">(</span><span class="n">Size</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cDefaultSize</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">size</span><span class="p">{</span><span class="n">size</span><span class="p">},</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">area</span><span class="p">(),</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">Empty</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos">31</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setTopLeft</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">topLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">32</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setBlock</span><span class="p">(</span><span class="n">Block</span><span class="w"> </span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">33</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">size</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">topLeft</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">34</span><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="n">size</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">topLeft</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block</span><span class="p">;</span>
<span class="linenos">35</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">36</span><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">PosArgs</span><span class="o">&gt;</span>
<span class="linenos">37</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setBlocks</span><span class="p">(</span><span class="n">Block</span><span class="w"> </span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">PosArgs</span><span class="p">...</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">38</span><span class="w">        </span><span class="p">(</span><span class="n">setBlock</span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">),</span><span class="w"> </span><span class="p">...);</span>
<span class="linenos">39</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">40</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">fillRect</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">rectTopLeft</span><span class="p">,</span><span class="w"> </span><span class="n">Size</span><span class="w"> </span><span class="n">rectSize</span><span class="p">,</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">41</span><span class="w">        </span><span class="n">rectSize</span><span class="p">.</span><span class="n">forEach</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">Position</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">setBlock</span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rectTopLeft</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<span class="linenos">42</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">43</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">blockAt</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">44</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">blockFromOrigin</span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">topLeft</span><span class="p">);</span>
<span class="linenos">45</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">46</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">blockFromOrigin</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">47</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">size</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">Empty</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">48</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">size</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">pos</span><span class="p">)];</span>
<span class="linenos">49</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">50</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">renderToConsole</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">51</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\x1b</span><span class="s">[0m&quot;</span><span class="p">;</span>
<span class="linenos">52</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">lastBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">Player</span><span class="p">;</span>
<span class="linenos">53</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">54</span><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">55</span><span class="w">                </span><span class="n">renderBlockAt</span><span class="p">({</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">},</span><span class="w"> </span><span class="n">lastBlock</span><span class="p">);</span>
<span class="linenos">56</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">57</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="linenos">58</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">59</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\x1b</span><span class="s">[0m</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">60</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">61</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">renderBlockAt</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lastBlock</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">62</span><span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="o">&gt;</span><span class="w"> </span><span class="n">walls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">63</span><span class="w">            </span><span class="s">&quot;■&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;╺&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;╻&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;┏&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;╸&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;━&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;┓&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;┳&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;╹&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;┗&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;┃&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;┣&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;┛&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;┻&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;┫&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;╋&quot;</span>
<span class="linenos">64</span><span class="w">        </span><span class="p">};</span>
<span class="linenos">65</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blockFromOrigin</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
<span class="linenos">66</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">lastBlock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">67</span><span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">68</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Empty</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\x1b</span><span class="s">[90m&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">69</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Wall</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\x1b</span><span class="s">[32m&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">70</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Room</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\x1b</span><span class="s">[0m&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;;</span>
<span class="linenos">71</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Exit</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\x1b</span><span class="s">[92m&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">72</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Player</span><span class="p">:</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">PlayerTrail</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\x1b</span><span class="s">[93m&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">73</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Robot</span><span class="p">:</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">RobotTrail</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\x1b</span><span class="s">[91m&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">74</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">75</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">76</span><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">77</span><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Empty</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;░&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">78</span><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Wall</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">walls</span><span class="p">[</span><span class="n">matchBlocks4</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">Wall</span><span class="p">)];</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">79</span><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Room</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">80</span><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Exit</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;⚑&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">81</span><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Player</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;☻&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">82</span><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">Robot</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;♟&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">83</span><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">PlayerTrail</span><span class="p">:</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="no">Block</span><span class="o">::</span><span class="no">RobotTrail</span><span class="p">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;∙&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">84</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">85</span><span class="w">        </span><span class="n">lastBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block</span><span class="p">;</span>
<span class="linenos">86</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">87</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">matchBlocks4</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">88</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">accumulate</span><span class="p">(</span><span class="n">cPosDelta4</span><span class="p">.</span><span class="n">rbegin</span><span class="p">(),</span><span class="w"> </span><span class="n">cPosDelta4</span><span class="p">.</span><span class="n">rend</span><span class="p">(),</span><span class="w"> </span><span class="mi">0U</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">89</span><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">acc</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">blockFromOrigin</span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">90</span><span class="w">        </span><span class="p">});</span>
<span class="linenos">91</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">92</span><span class="p">};</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../_downloads/ced6f9d5130cccedf97c0f3eff1af319/Canvas.hpp"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Canvas.hpp</span></code></a></p>
</section>
<section id="the-world">
<h2>The World<a class="headerlink" href="#the-world" title="Link to this heading"></a></h2>
<p>Next, we define the data structures that represent the game world.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">robot-escape/src/World.hpp</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#pragma once</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Geometry.hpp&quot;</span>
<span class="linenos">  4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Canvas.hpp&quot;</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ranges&gt;</span>
<span class="linenos">  7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<span class="linenos">  8</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="k">template</span><span class="o">&lt;</span><span class="n">Block</span><span class="w"> </span><span class="n">tElementBlock</span><span class="p">,</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="n">tTrailBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tElementBlock</span><span class="o">&gt;</span>
<span class="linenos"> 11</span><span class="k">struct</span><span class="w"> </span><span class="nc">ElementWithPos</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 12</span><span class="w">    </span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">{};</span>
<span class="linenos"> 13</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Position</span><span class="o">&gt;</span><span class="w"> </span><span class="n">trail</span><span class="p">;</span>
<span class="linenos"> 14</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">moveTo</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">newPos</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 17</span><span class="w">        </span><span class="n">trail</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
<span class="linenos"> 18</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">trail</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">trail</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">trail</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 19</span><span class="w">        </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newPos</span><span class="p">;</span>
<span class="linenos"> 20</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">&amp;</span><span class="n">canvas</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 23</span><span class="w">        </span><span class="n">canvas</span><span class="p">.</span><span class="n">setBlock</span><span class="p">(</span><span class="n">tElementBlock</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<span class="linenos"> 24</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">trailPos</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">trail</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 25</span><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">currentBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">canvas</span><span class="p">.</span><span class="n">blockAt</span><span class="p">(</span><span class="n">trailPos</span><span class="p">);</span>
<span class="linenos"> 26</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentBlock</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">Room</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">currentBlock</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">RobotTrail</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">canvas</span><span class="p">.</span><span class="n">setBlock</span><span class="p">(</span><span class="n">tTrailBlock</span><span class="p">,</span><span class="w"> </span><span class="n">trailPos</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 27</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 29</span><span class="p">};</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span><span class="k">using</span><span class="w"> </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ElementWithPos</span><span class="o">&lt;</span><span class="n">Block</span><span class="o">::</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">PlayerTrail</span><span class="o">&gt;</span><span class="p">;</span>
<span class="linenos"> 32</span><span class="k">using</span><span class="w"> </span><span class="n">Robot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ElementWithPos</span><span class="o">&lt;</span><span class="n">Block</span><span class="o">::</span><span class="n">Robot</span><span class="p">,</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">RobotTrail</span><span class="o">&gt;</span><span class="p">;</span>
<span class="linenos"> 33</span><span class="k">using</span><span class="w"> </span><span class="n">Exit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ElementWithPos</span><span class="o">&lt;</span><span class="n">Block</span><span class="o">::</span><span class="n">Exit</span><span class="o">&gt;</span><span class="p">;</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span><span class="k">struct</span><span class="w"> </span><span class="nc">Field</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 36</span><span class="w">    </span><span class="n">Size</span><span class="w"> </span><span class="n">size</span><span class="p">{};</span>
<span class="linenos"> 37</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">&amp;</span><span class="n">canvas</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 38</span><span class="w">        </span><span class="n">canvas</span><span class="p">.</span><span class="n">fillRect</span><span class="p">(</span><span class="n">Position</span><span class="p">{</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span><span class="w"> </span><span class="n">Size</span><span class="p">{</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">Wall</span><span class="p">);</span>
<span class="linenos"> 39</span><span class="w">        </span><span class="n">canvas</span><span class="p">.</span><span class="n">fillRect</span><span class="p">(</span><span class="n">Position</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">Block</span><span class="o">::</span><span class="n">Room</span><span class="p">);</span>
<span class="linenos"> 40</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 41</span><span class="p">};</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span><span class="k">struct</span><span class="w"> </span><span class="nc">World</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 44</span><span class="w">    </span><span class="n">Field</span><span class="w"> </span><span class="n">field</span><span class="p">;</span>
<span class="linenos"> 45</span><span class="w">    </span><span class="n">Player</span><span class="w"> </span><span class="n">player</span><span class="p">;</span>
<span class="linenos"> 46</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Robot</span><span class="o">&gt;</span><span class="w"> </span><span class="n">robots</span><span class="p">;</span>
<span class="linenos"> 47</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Exit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">exits</span><span class="p">;</span>
<span class="linenos"> 48</span>
<span class="linenos"> 49</span><span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">World</span><span class="p">(</span><span class="n">Size</span><span class="w"> </span><span class="n">fieldSize</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">field</span><span class="p">{</span><span class="n">fieldSize</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos"> 50</span><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="linenos"> 51</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">tooNear</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">elements</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 52</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">any_of</span><span class="p">(</span><span class="n">elements</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">elements</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">element</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 53</span><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">.</span><span class="n">pos</span><span class="p">.</span><span class="n">distanceTo</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="linenos"> 54</span><span class="w">        </span><span class="p">});</span>
<span class="linenos"> 55</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 56</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">isValidPlayerMovement</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 57</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">field</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
<span class="linenos"> 58</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 59</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">isValidRobotMovement</span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 60</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">field</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">tooNear</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">robots</span><span class="p">);</span>
<span class="linenos"> 61</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 62</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">isPlayerOnExit</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 63</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ranges</span><span class="o">::</span><span class="n">any_of</span><span class="p">(</span><span class="n">exits</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">Exit</span><span class="w"> </span><span class="o">&amp;</span><span class="n">exit</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">exit</span><span class="p">.</span><span class="n">pos</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos"> 64</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 65</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">isRobotOnPlayer</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 66</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ranges</span><span class="o">::</span><span class="n">any_of</span><span class="p">(</span><span class="n">robots</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">Robot</span><span class="w"> </span><span class="o">&amp;</span><span class="n">robot</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">robot</span><span class="p">.</span><span class="n">pos</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<span class="linenos"> 67</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 68</span><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Fn</span><span class="o">&gt;</span>
<span class="linenos"> 69</span><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">randomValidFieldPosition</span><span class="p">(</span><span class="n">Fn</span><span class="w"> </span><span class="n">fn</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 70</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">validPositions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">field</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">filterPositions</span><span class="p">(</span><span class="n">fn</span><span class="p">);</span>
<span class="linenos"> 71</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">validPositions</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 72</span><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">{</span><span class="s">&quot;Could not find a valid position&quot;</span><span class="p">};</span>
<span class="linenos"> 73</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 74</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">validPositions</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">validPositions</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span>
<span class="linenos"> 75</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 76</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">addExitAtRandomPosition</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 77</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Exit</span><span class="p">{</span><span class="n">randomValidFieldPosition</span><span class="p">([](</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">){</span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;})};</span>
<span class="linenos"> 78</span><span class="w">        </span><span class="n">exits</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">exit</span><span class="p">));</span>
<span class="linenos"> 79</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 80</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setPlayerToRandomPosition</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 81</span><span class="w">        </span><span class="n">player</span><span class="p">.</span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomValidFieldPosition</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 82</span><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">tooNear</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">exits</span><span class="p">);</span>
<span class="linenos"> 83</span><span class="w">        </span><span class="p">});</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 85</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">addRobotAtRandomPosition</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 86</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">robot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Robot</span><span class="p">{</span><span class="n">randomValidFieldPosition</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">Position</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 87</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">pos</span><span class="p">.</span><span class="n">distanceTo</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 88</span><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">tooNear</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">exits</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">tooNear</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">robots</span><span class="p">);</span>
<span class="linenos"> 89</span><span class="w">        </span><span class="p">})};</span>
<span class="linenos"> 90</span><span class="w">        </span><span class="n">robot</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Robot {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">robots</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="linenos"> 91</span><span class="w">        </span><span class="n">robots</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">robot</span><span class="p">));</span>
<span class="linenos"> 92</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 93</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">render</span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">&amp;</span><span class="n">canvas</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 94</span><span class="w">        </span><span class="n">canvas</span><span class="p">.</span><span class="n">setTopLeft</span><span class="p">(</span><span class="n">canvas</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">center</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">field</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">center</span><span class="p">());</span>
<span class="linenos"> 95</span><span class="w">        </span><span class="n">field</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">canvas</span><span class="p">);</span>
<span class="linenos"> 96</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">exit</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">exits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 97</span><span class="w">            </span><span class="n">exit</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">canvas</span><span class="p">);</span>
<span class="linenos"> 98</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 99</span><span class="w">        </span><span class="n">player</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">canvas</span><span class="p">);</span>
<span class="linenos">100</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">robot</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">robots</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">101</span><span class="w">            </span><span class="n">robot</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">canvas</span><span class="p">);</span>
<span class="linenos">102</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">103</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">104</span><span class="p">};</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../_downloads/d3d1b3cd8b3e6595658652ca37d7723c/World.hpp"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">World.hpp</span></code></a></p>
<p>This file introduces the main game elements: <code class="docutils literal notranslate"><span class="pre">Player</span></code>, <code class="docutils literal notranslate"><span class="pre">Robot</span></code>, and <code class="docutils literal notranslate"><span class="pre">Exit</span></code>. These are placed within the <code class="docutils literal notranslate"><span class="pre">Field</span></code> class, which defines the map the game is played on. All of these are grouped into the <code class="docutils literal notranslate"><span class="pre">World</span></code> structure—a complete model of the game’s state.</p>
<p>This abstraction allows us to easily render the game state and apply game logic to it.</p>
</section>
<section id="game-logic">
<h2>Game Logic<a class="headerlink" href="#game-logic" title="Link to this heading"></a></h2>
<p>So far, we’ve only set up static structures. Now it’s time to make things dynamic.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">robot-escape/src/Logic.hpp</span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#pragma once</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Canvas.hpp&quot;</span>
<span class="linenos">  4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;World.hpp&quot;</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="linenos">  7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;map&gt;</span>
<span class="linenos">  8</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<span class="linenos">  9</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<span class="linenos"> 10</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;limits&gt;</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="k">struct</span><span class="w"> </span><span class="nc">PlayerInput</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 13</span><span class="w">    </span><span class="n">Position</span><span class="w"> </span><span class="n">movement</span><span class="p">;</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">PlayerInput</span><span class="w"> </span><span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="linenos"> 16</span><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">PlayerInput</span><span class="w"> </span><span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="linenos"> 17</span><span class="p">};</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">cQuitInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerInput</span><span class="p">{</span><span class="n">Position</span><span class="p">{</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">}};</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">inputFromConsole</span><span class="p">()</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PlayerInput</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 22</span><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">validInputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerInput</span><span class="o">&gt;</span><span class="p">{</span>
<span class="linenos"> 23</span><span class="w">        </span><span class="p">{</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">Position</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}}},</span>
<span class="linenos"> 24</span><span class="w">        </span><span class="p">{</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">Position</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">}}},</span>
<span class="linenos"> 25</span><span class="w">        </span><span class="p">{</span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">Position</span><span class="p">{</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}}},</span>
<span class="linenos"> 26</span><span class="w">        </span><span class="p">{</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">Position</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">}}},</span>
<span class="linenos"> 27</span><span class="w">        </span><span class="p">{</span><span class="s">&quot;q&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cQuitInput</span><span class="p">},</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="p">};</span>
<span class="linenos"> 29</span><span class="w">    </span><span class="n">PlayerInput</span><span class="w"> </span><span class="n">playerInput</span><span class="p">;</span>
<span class="linenos"> 30</span><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">playerInput</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PlayerInput</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 31</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Enter your move (n/e/s/w/q=quit): &quot;</span><span class="p">;</span>
<span class="linenos"> 32</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">flush</span><span class="p">();</span>
<span class="linenos"> 33</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">input</span><span class="p">;</span>
<span class="linenos"> 34</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">);</span>
<span class="linenos"> 35</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validInputs</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
<span class="linenos"> 36</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">validInputs</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 37</span><span class="w">            </span><span class="n">playerInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
<span class="linenos"> 38</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 39</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Invalid input. Please try again.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos"> 40</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 41</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 42</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">playerInput</span><span class="p">;</span>
<span class="linenos"> 43</span><span class="p">}</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">GameState</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 46</span><span class="w">    </span><span class="n">Running</span><span class="p">,</span>
<span class="linenos"> 47</span><span class="w">    </span><span class="n">PlayerWon</span><span class="p">,</span>
<span class="linenos"> 48</span><span class="w">    </span><span class="n">RobotsWon</span><span class="p">,</span>
<span class="linenos"> 49</span><span class="p">};</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span><span class="k">struct</span><span class="w"> </span><span class="nc">PlayerLogic</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 52</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">advance</span><span class="p">(</span><span class="n">PlayerInput</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">World</span><span class="w"> </span><span class="o">&amp;</span><span class="n">world</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 53</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">newPlayerPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">world</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">movement</span><span class="p">;</span>
<span class="linenos"> 54</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">isValidPlayerMovement</span><span class="p">(</span><span class="n">newPlayerPos</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 55</span><span class="w">            </span><span class="n">world</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">newPlayerPos</span><span class="p">);</span>
<span class="linenos"> 56</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 57</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Could not move in this direction. You lost one move.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos"> 58</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 59</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 60</span><span class="p">};</span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span><span class="k">struct</span><span class="w"> </span><span class="nc">RobotLogic</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 63</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">advance</span><span class="p">(</span><span class="n">Robot</span><span class="w"> </span><span class="o">&amp;</span><span class="n">robot</span><span class="p">,</span><span class="w"> </span><span class="n">World</span><span class="w"> </span><span class="o">&amp;</span><span class="n">world</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 64</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">robot</span><span class="p">.</span><span class="n">pos</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">world</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 65</span><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bestDistance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>
<span class="linenos"> 66</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Position</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bestMoves</span><span class="p">;</span>
<span class="linenos"> 67</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">cPosDelta4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 68</span><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">robot</span><span class="p">.</span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">delta</span><span class="p">;</span>
<span class="linenos"> 69</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">world</span><span class="p">.</span><span class="n">isValidRobotMovement</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="linenos"> 70</span><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">distanceTo</span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">pos</span><span class="p">);</span>
<span class="linenos"> 71</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dist</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">bestDistance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">bestMoves</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">pos</span><span class="p">};</span><span class="w"> </span><span class="n">bestDistance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dist</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 72</span><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dist</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bestDistance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">bestMoves</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 73</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 74</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bestMoves</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="linenos"> 75</span><span class="w">        </span><span class="n">robot</span><span class="p">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">bestMoves</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">bestMoves</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)]);</span>
<span class="linenos"> 76</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 77</span><span class="p">};</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span><span class="k">struct</span><span class="w"> </span><span class="nc">Logic</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 80</span><span class="w">    </span><span class="n">World</span><span class="w"> </span><span class="n">world</span><span class="p">;</span>
<span class="linenos"> 81</span><span class="w">    </span><span class="n">PlayerLogic</span><span class="w"> </span><span class="n">playerLogic</span><span class="p">;</span>
<span class="linenos"> 82</span><span class="w">    </span><span class="n">RobotLogic</span><span class="w"> </span><span class="n">robotLogic</span><span class="p">;</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">Logic</span><span class="p">(</span><span class="n">World</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">initialWorld</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">world</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">initialWorld</span><span class="p">)}</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">advance</span><span class="p">(</span><span class="n">PlayerInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 87</span><span class="w">        </span><span class="n">playerLogic</span><span class="p">.</span><span class="n">advance</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">world</span><span class="p">);</span>
<span class="linenos"> 88</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">robot</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">world</span><span class="p">.</span><span class="n">robots</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 89</span><span class="w">            </span><span class="n">robotLogic</span><span class="p">.</span><span class="n">advance</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span><span class="w"> </span><span class="n">world</span><span class="p">);</span>
<span class="linenos"> 90</span><span class="w">        </span><span class="p">}</span>
<span class="linenos"> 91</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">gameState</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GameState</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 94</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">isPlayerOnExit</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">GameState</span><span class="o">::</span><span class="n">PlayerWon</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 95</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">isRobotOnPlayer</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">GameState</span><span class="o">::</span><span class="n">RobotsWon</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 96</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">GameState</span><span class="o">::</span><span class="n">Running</span><span class="p">;</span>
<span class="linenos"> 97</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">render</span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">&amp;</span><span class="n">canvas</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">100</span><span class="w">        </span><span class="n">world</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">canvas</span><span class="p">);</span>
<span class="linenos">101</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">102</span><span class="p">};</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../_downloads/31a313e8383d9ac4d6d3943f7234acde/Logic.hpp"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Logic.hpp</span></code></a></p>
<p>The game logic includes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">inputFromConsole()</span></code> — handles user input.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PlayerLogic</span></code> and <code class="docutils literal notranslate"><span class="pre">RobotLogic</span></code> — define movement behavior for players and robots.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Logic</span></code> — combines everything and drives the game forward by updating the world based on player actions.</p></li>
</ul>
</section>
<section id="using-the-game-classes">
<h2>Using the Game Classes<a class="headerlink" href="#using-the-game-classes" title="Link to this heading"></a></h2>
<p>We’re ready to glue everything together.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">robot-escape/src/Application.hpp</span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#pragma once</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Canvas.hpp&quot;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Logic.hpp&quot;</span>
<span class="linenos"> 5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;World.hpp&quot;</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;erbsland/all_conf.hpp&gt;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;filesystem&gt;</span>
<span class="linenos">10</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">el</span><span class="o">::</span><span class="nn">conf</span><span class="p">;</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="k">struct</span><span class="w"> </span><span class="nc">Application</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">15</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">path</span><span class="w"> </span><span class="n">configPath</span><span class="p">;</span>
<span class="linenos">16</span><span class="w">    </span><span class="n">DocumentPtr</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
<span class="linenos">17</span><span class="w">    </span><span class="n">Size</span><span class="w"> </span><span class="n">canvasSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">::</span><span class="n">cDefaultSize</span><span class="p">;</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">cMinimumSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Size</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">};</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">parseArgs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">22</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">23</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Usage: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &lt;config-file&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">24</span><span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">25</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">26</span><span class="w">        </span><span class="n">configPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">path</span><span class="p">{</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]};</span>
<span class="linenos">27</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">28</span>
<span class="linenos">29</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">readConfiguration</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">30</span><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">31</span><span class="w">            </span><span class="n">Parser</span><span class="w"> </span><span class="n">parser</span><span class="p">;</span>
<span class="linenos">32</span><span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Source</span><span class="o">::</span><span class="n">fromFile</span><span class="p">(</span><span class="n">configPath</span><span class="p">);</span>
<span class="linenos">33</span><span class="w">            </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">parseOrThrow</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
<span class="linenos">34</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">35</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="n">toText</span><span class="p">().</span><span class="n">toCharString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">36</span><span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">37</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">38</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="w">    </span><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">buildWorld</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">World</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">41</span><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">42</span><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">fieldSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Size</span><span class="p">{</span>
<span class="linenos">43</span><span class="w">                </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">config</span><span class="o">-&gt;</span><span class="n">getIntegerOrThrow</span><span class="p">(</span><span class="sa">u8</span><span class="s">&quot;field.width&quot;</span><span class="p">)),</span>
<span class="linenos">44</span><span class="w">                </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">config</span><span class="o">-&gt;</span><span class="n">getIntegerOrThrow</span><span class="p">(</span><span class="sa">u8</span><span class="s">&quot;field.height&quot;</span><span class="p">))};</span>
<span class="linenos">45</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cMinimumSize</span><span class="p">.</span><span class="n">fitsInto</span><span class="p">(</span><span class="n">fieldSize</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">46</span><span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Field size must be at least {}x{}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cMinimumSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">cMinimumSize</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
<span class="linenos">47</span><span class="w">                </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">48</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">49</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">fieldSize</span><span class="p">.</span><span class="n">fitsInto</span><span class="p">(</span><span class="n">canvasSize</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">50</span><span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Field size must be at most {}x{}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">canvasSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">canvasSize</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
<span class="linenos">51</span><span class="w">                </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">52</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">53</span><span class="w">            </span><span class="n">World</span><span class="w"> </span><span class="n">world</span><span class="p">{</span><span class="n">fieldSize</span><span class="p">};</span>
<span class="linenos">54</span><span class="w">            </span><span class="n">world</span><span class="p">.</span><span class="n">addExitAtRandomPosition</span><span class="p">();</span>
<span class="linenos">55</span><span class="w">            </span><span class="n">world</span><span class="p">.</span><span class="n">setPlayerToRandomPosition</span><span class="p">();</span>
<span class="linenos">56</span><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">57</span><span class="w">                </span><span class="n">world</span><span class="p">.</span><span class="n">addRobotAtRandomPosition</span><span class="p">();</span>
<span class="linenos">58</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">59</span><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">world</span><span class="p">;</span>
<span class="linenos">60</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">61</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="n">toText</span><span class="p">().</span><span class="n">toCharString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">62</span><span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">63</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">64</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">65</span>
<span class="linenos">66</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">renderLogic</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Logic</span><span class="w"> </span><span class="o">&amp;</span><span class="n">logic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">67</span><span class="w">        </span><span class="n">Canvas</span><span class="w"> </span><span class="n">canvas</span><span class="p">{</span><span class="n">canvasSize</span><span class="p">};</span>
<span class="linenos">68</span><span class="w">        </span><span class="n">logic</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">canvas</span><span class="p">);</span>
<span class="linenos">69</span><span class="w">        </span><span class="n">canvas</span><span class="p">.</span><span class="n">renderToConsole</span><span class="p">();</span>
<span class="linenos">70</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">71</span>
<span class="linenos">72</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">73</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">initialWorld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buildWorld</span><span class="p">();</span>
<span class="linenos">74</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;----------------------------==[ ROBOT ESCAPE ]==-----------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">75</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Welcome to Robot Escape!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">76</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;You (☻) must run to the exit (⚑) before any robot (♟) catches you.</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">77</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Logic</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">initialWorld</span><span class="p">)};</span>
<span class="linenos">78</span><span class="w">        </span><span class="n">renderLogic</span><span class="p">(</span><span class="n">logic</span><span class="p">);</span>
<span class="linenos">79</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logic</span><span class="p">.</span><span class="n">gameState</span><span class="p">();</span>
<span class="linenos">80</span><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GameState</span><span class="o">::</span><span class="n">Running</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">81</span><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">playerInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inputFromConsole</span><span class="p">();</span>
<span class="linenos">82</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">playerInput</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cQuitInput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">83</span><span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Goodbye!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">84</span><span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="linenos">85</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">86</span><span class="w">            </span><span class="n">logic</span><span class="p">.</span><span class="n">advance</span><span class="p">(</span><span class="n">playerInput</span><span class="p">);</span>
<span class="linenos">87</span><span class="w">            </span><span class="n">renderLogic</span><span class="p">(</span><span class="n">logic</span><span class="p">);</span>
<span class="linenos">88</span><span class="w">            </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logic</span><span class="p">.</span><span class="n">gameState</span><span class="p">();</span>
<span class="linenos">89</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">90</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GameState</span><span class="o">::</span><span class="n">PlayerWon</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">91</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;You won!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">92</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">93</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;You lost!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos">94</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">95</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">96</span><span class="p">};</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../_downloads/c8156af8fe27a4e97ed3aba34e2aa064/Application.hpp"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Application.hpp</span></code></a></p>
<p>The <code class="docutils literal notranslate"><span class="pre">Application</span></code> class handles the full game flow:</p>
<ul class="simple">
<li><p>Parses command-line arguments.</p></li>
<li><p>Loads the configuration file.</p></li>
<li><p>Builds the initial <code class="docutils literal notranslate"><span class="pre">World</span></code> state.</p></li>
<li><p>Starts and runs the game loop.</p></li>
</ul>
<p>The loop displays instructions, initializes the game logic, renders the world, waits for input, processes the input, and repeats—until either the player or the robots win.</p>
</section>
<section id="replacing-the-old-main-function">
<h2>Replacing the Old Main Function<a class="headerlink" href="#replacing-the-old-main-function" title="Link to this heading"></a></h2>
<p>With the new <code class="docutils literal notranslate"><span class="pre">Application</span></code> class in place, we can simplify our <code class="docutils literal notranslate"><span class="pre">main</span></code> function dramatically:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">robot-escape/src/main.cpp</span><a class="headerlink" href="#id6" title="Link to this code"></a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Application.hpp&quot;</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">4</span><span class="w">    </span><span class="n">Application</span><span class="w"> </span><span class="n">app</span><span class="p">;</span>
<span class="linenos">5</span><span class="w">    </span><span class="n">app</span><span class="p">.</span><span class="n">parseArgs</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="linenos">6</span><span class="w">    </span><span class="n">app</span><span class="p">.</span><span class="n">readConfiguration</span><span class="p">();</span>
<span class="linenos">7</span><span class="w">    </span><span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
<span class="linenos">8</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../_downloads/3ab238608f9fefa07304efcfb5a18fc9/main.cpp"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">main.cpp</span></code></a></p>
</section>
<section id="adding-the-new-files-to-cmake">
<h2>Adding the New Files to CMake<a class="headerlink" href="#adding-the-new-files-to-cmake" title="Link to this heading"></a></h2>
<p>Finally, we have to add the new source files to our CMake file.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">robot-escape/CMakeLists.txt</span><a class="headerlink" href="#id7" title="Link to this code"></a></div>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.25</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">RobotEscapeApp</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">robot-escape</span>
<span class="hll"><span class="w">        </span><span class="s">src/Canvas.hpp</span>
</span><span class="hll"><span class="w">        </span><span class="s">src/World.hpp</span>
</span><span class="hll"><span class="w">        </span><span class="s">src/Geometry.hpp</span>
</span><span class="hll"><span class="w">        </span><span class="s">src/Logic.hpp</span>
</span><span class="w">        </span><span class="s">src/main.cpp</span><span class="p">)</span>
<span class="nb">target_compile_features</span><span class="p">(</span><span class="s">robot-escape</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">cxx_std_20</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">robot-escape</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">erbsland-configuration-parser</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="recap">
<h2>Recap<a class="headerlink" href="#recap" title="Link to this heading"></a></h2>
<p>That was quite a bit of code! But with it, we now have a functioning game loop and a flexible foundation you can build on.</p>
<p>We’ve kept things as simple as possible while still providing enough structure to be engaging and fun to extend. Try tweaking parts of the game and see what happens—you’re in full control!</p>
<p class="sd-text-center"><span class="sd-d-grid"><a class="sd-sphinx-override sd-btn sd-text-wrap sd-btn-success sd-fs-5 sd-font-weight-bold sd-p-2 sd-my-4 reference internal" href="07-compile-and-run.html"><span class="doc">Compile and Run our Game →</span></a></span></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="05-provoking-errors.html" class="btn btn-neutral float-left" title="Provoking Some Errors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="07-compile-and-run.html" class="btn btn-neutral float-right" title="Compile and Run Our Game" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-2025, Tobias Erbsland - Erbsland DEV.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>